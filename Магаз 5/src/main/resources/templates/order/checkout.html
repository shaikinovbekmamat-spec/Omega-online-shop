<!DOCTYPE html>
<html lang="ru"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ - OMEGA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
          rel="stylesheet">
    <style>
        body { padding-top: 70px; }
        .order-summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            position: sticky;
            top: 90px;
        }
        .item-row {
            border-bottom: 1px solid #dee2e6;
            padding: 10px 0;
        }
    </style>
</head>
<body>
<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container">
        <a class="navbar-brand" th:href="@{/}"><strong>OMEGA</strong></a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" th:href="@{/}">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/catalog}">–ö–∞—Ç–∞–ª–æ–≥</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/cart}">–ö–æ—Ä–∑–∏–Ω–∞</a></li>
                <li class="nav-item dropdown" sec:authorize="isAuthenticated()">
                    <a class="nav-link dropdown-toggle" href="#" role="button"
                       data-bs-toggle="dropdown">
                        <span sec:authentication="name">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" th:href="@{/orders}">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</a></li>
                        <li sec:authorize="hasRole('ADMIN')"><hr class="dropdown-divider"></li>
                        <li sec:authorize="hasRole('ADMIN')">
                            <a class="dropdown-item" th:href="@{/admin}">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <form th:action="@{/logout}" method="post" class="px-3 py-2">
                                <button type="submit" class="btn btn-danger btn-sm w-100">–í—ã—Ö–æ–¥</button>
                            </form>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container my-5">
    <!-- –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a th:href="@{/}">–ì–ª–∞–≤–Ω–∞—è</a></li>
            <li class="breadcrumb-item"><a th:href="@{/cart}">–ö–æ—Ä–∑–∏–Ω–∞</a></li>
            <li class="breadcrumb-item active">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</li>
        </ol>
    </nav>

    <h1 class="mb-4">üì¶ –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h1>

    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ -->
    <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show">
        <span th:text="${errorMessage}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div class="row">
        <!-- –§–æ—Ä–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è -->
        <div class="col-lg-7">
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title mb-4">–î–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç–∞–≤–∫–∏</h5>

                    <form th:action="@{/checkout}" th:object="${orderDto}" method="post">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">

                        <!-- –¢–µ–ª–µ—Ñ–æ–Ω -->
                        <div class="mb-3">
                            <label for="phone" class="form-label">
                                –¢–µ–ª–µ—Ñ–æ–Ω <span class="text-danger">*</span>
                            </label>
                            <input type="tel"
                                   class="form-control"
                                   id="phone"
                                   th:field="*{phone}"
                                   th:classappend="${#fields.hasErrors('phone')} ? 'is-invalid' : ''"
                                   placeholder="(+999)-999-999-999">
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('phone')}">
                                <span th:errors="*{phone}"></span>
                            </div>
                            <div class="form-text">–§–æ—Ä–º–∞—Ç: (+999)-999-999-999</div>
                        </div>

                        <!-- –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ -->
                        <div class="mb-3">
                            <label for="deliveryAddress" class="form-label">
                                –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ <span class="text-danger">*</span>
                            </label>
                            <textarea class="form-control"
                                      id="deliveryAddress"
                                      th:field="*{deliveryAddress}"
                                      th:classappend="${#fields.hasErrors('deliveryAddress')} ? 'is-invalid' : ''"
                                      rows="3"
                                      placeholder="–ì–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞"></textarea>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('deliveryAddress')}">
                                <span th:errors="*{deliveryAddress}"></span>
                            </div>
                        </div>

                        <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π -->
                        <div class="mb-4">
                            <label for="comment" class="form-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É</label>
                            <textarea class="form-control"
                                      id="comment"
                                      th:field="*{comment}"
                                      rows="3"
                                      placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></textarea>
                            <div class="form-text">–£–∫–∞–∂–∏—Ç–µ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏, –∫–æ–¥ –¥–æ–º–æ—Ñ–æ–Ω–∞ –∏ —Ç.–¥.</div>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-success btn-lg">
                                ‚úÖ –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
                            </button>
                            <a th:href="@{/cart}" class="btn btn-outline-secondary">
                                ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–æ—Ä–∑–∏–Ω—É
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- –ò—Ç–æ–≥–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="col-lg-5">
            <div class="order-summary">
                <h5 class="mb-3">–í–∞—à –∑–∞–∫–∞–∑</h5>

                <!-- –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ -->
                <div class="mb-3">
                    <div th:each="item : ${cart.items}" class="item-row">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="flex-grow-1">
                                <strong th:text="${item.productName}">–¢–æ–≤–∞—Ä</strong>
                                <br>
                                <small class="text-muted">
                                    [[${#numbers.formatDecimal(item.price, 0, 'WHITESPACE', 2, 'POINT')}]] —Å–æ–º
                                    √ó [[${item.quantity}]] —à—Ç.
                                </small>
                            </div>
                            <div class="text-end">
                                <strong th:text="${#numbers.formatDecimal(item.totalPrice, 0, 'WHITESPACE', 2, 'POINT')} + ' —Å–æ–º'">
                                    0 —Å–æ–º
                                </strong>
                            </div>
                        </div>
                    </div>
                </div>

                <hr>

                <!-- –ò—Ç–æ–≥–æ -->
                <div class="d-flex justify-content-between mb-2">
                    <span>–¢–æ–≤–∞—Ä–æ–≤:</span>
                    <strong>[[${cart.totalItems}]] —à—Ç.</strong>
                </div>

                <div class="d-flex justify-content-between mb-3">
                    <h5>–ò—Ç–æ–≥–æ:</h5>
                    <h5 class="text-success">
                        [[${#numbers.formatDecimal(cart.totalPrice, 0, 'WHITESPACE', 2, 'POINT')}]] —Å–æ–º
                    </h5>
                </div>

                <div class="alert alert-info small mb-0">
                    <strong>‚ÑπÔ∏è –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ:</strong>
                    <ul class="mb-0 mt-2">
                        <li>–î–æ—Å—Ç–∞–≤–∫–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ</li>
                        <li>–û–ø–ª–∞—Ç–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏</li>
                        <li>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–≤–∞—Ä–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>